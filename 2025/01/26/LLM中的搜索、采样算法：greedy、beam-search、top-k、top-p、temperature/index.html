<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"luyiyun1021.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="éšç€chatGPTï¼ŒchatGLMã€Llamaç­‰LLMæ¨¡å‹çš„ç«çˆ†ï¼Œç”Ÿæˆå¼æ¨¡å‹é€æ¸è¢«å¤§å®¶æ‰€ç†ŸçŸ¥å’Œè®¤å¯ã€‚ LLMçœ‹ä¼¼å¾ˆç¥å¥‡ï¼Œä½†ç©¶å…¶æœ¬è´¨è¿˜æ˜¯ä¸€ä¸ªæ¦‚ç‡ç›¸å…³çš„é—®é¢˜ï¼šç¥ç»ç½‘ç»œæ ¹æ®è¾“å…¥çš„æ–‡æœ¬ï¼Œæ‰§è¡Œå¤šè½®decoderã€‚ æ¯æ¬¡decoderæ—¶å€™ä»é¢„è®­ç»ƒçš„æ¨¡å‹é‡Œé¢ç”Ÿæˆä¸€å †å€™é€‰è¯ï¼ˆåŠå…¶æ¦‚ç‡&#x2F;åˆ†æ•°ï¼‰ï¼ŒæŒ‰ç…§æŒ‡å®šçš„è§£ç ç®—æ³•æˆ–è€…è¯´åå¤„ç†ç®—æ³•ï¼Œé€‰æ‹©å‡ºå€™é€‰è¯ï¼ŒçŸ¥é“æ»¡è¶³ç»“æŸğŸ”šæ¡ä»¶ä¸ºæ­¢ã€‚ åŒæ ·çš„LLMæ¨¡å‹ï¼Œå¦‚æœé‡‡ç”¨çš„åå¤„ç†ç®—æ³•ã€ç®—">
<meta property="og:type" content="article">
<meta property="og:title" content="LLMä¸­çš„æœç´¢ã€é‡‡æ ·ç®—æ³•ï¼šgreedyã€beam_searchã€top_kã€top_pã€temperature">
<meta property="og:url" content="https://luyiyun1021.github.io/2025/01/26/LLM%E4%B8%AD%E7%9A%84%E6%90%9C%E7%B4%A2%E3%80%81%E9%87%87%E6%A0%B7%E7%AE%97%E6%B3%95%EF%BC%9Agreedy%E3%80%81beam-search%E3%80%81top-k%E3%80%81top-p%E3%80%81temperature/index.html">
<meta property="og:site_name" content="Ronny Lu&#39;s blog">
<meta property="og:description" content="éšç€chatGPTï¼ŒchatGLMã€Llamaç­‰LLMæ¨¡å‹çš„ç«çˆ†ï¼Œç”Ÿæˆå¼æ¨¡å‹é€æ¸è¢«å¤§å®¶æ‰€ç†ŸçŸ¥å’Œè®¤å¯ã€‚ LLMçœ‹ä¼¼å¾ˆç¥å¥‡ï¼Œä½†ç©¶å…¶æœ¬è´¨è¿˜æ˜¯ä¸€ä¸ªæ¦‚ç‡ç›¸å…³çš„é—®é¢˜ï¼šç¥ç»ç½‘ç»œæ ¹æ®è¾“å…¥çš„æ–‡æœ¬ï¼Œæ‰§è¡Œå¤šè½®decoderã€‚ æ¯æ¬¡decoderæ—¶å€™ä»é¢„è®­ç»ƒçš„æ¨¡å‹é‡Œé¢ç”Ÿæˆä¸€å †å€™é€‰è¯ï¼ˆåŠå…¶æ¦‚ç‡&#x2F;åˆ†æ•°ï¼‰ï¼ŒæŒ‰ç…§æŒ‡å®šçš„è§£ç ç®—æ³•æˆ–è€…è¯´åå¤„ç†ç®—æ³•ï¼Œé€‰æ‹©å‡ºå€™é€‰è¯ï¼ŒçŸ¥é“æ»¡è¶³ç»“æŸğŸ”šæ¡ä»¶ä¸ºæ­¢ã€‚ åŒæ ·çš„LLMæ¨¡å‹ï¼Œå¦‚æœé‡‡ç”¨çš„åå¤„ç†ç®—æ³•ã€ç®—">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ronny-1333301201.cos.ap-shanghai.myqcloud.com/20250126164404188.png">
<meta property="og:image" content="https://ronny-1333301201.cos.ap-shanghai.myqcloud.com/20250126164417747.png">
<meta property="og:image" content="https://ronny-1333301201.cos.ap-shanghai.myqcloud.com/20250126165035897.png">
<meta property="og:image" content="https://ronny-1333301201.cos.ap-shanghai.myqcloud.com/20250126165013919.png">
<meta property="og:image" content="https://ronny-1333301201.cos.ap-shanghai.myqcloud.com/20250126165204926.png">
<meta property="article:published_time" content="2025-01-26T09:26:13.000Z">
<meta property="article:modified_time" content="2025-01-26T09:26:48.720Z">
<meta property="article:author" content="Ronny Lu">
<meta property="article:tag" content="å¤§æ¨¡å‹">
<meta property="article:tag" content="å¤§æ¨¡å‹æ¨ç†">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ronny-1333301201.cos.ap-shanghai.myqcloud.com/20250126164404188.png">


<link rel="canonical" href="https://luyiyun1021.github.io/2025/01/26/LLM%E4%B8%AD%E7%9A%84%E6%90%9C%E7%B4%A2%E3%80%81%E9%87%87%E6%A0%B7%E7%AE%97%E6%B3%95%EF%BC%9Agreedy%E3%80%81beam-search%E3%80%81top-k%E3%80%81top-p%E3%80%81temperature/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://luyiyun1021.github.io/2025/01/26/LLM%E4%B8%AD%E7%9A%84%E6%90%9C%E7%B4%A2%E3%80%81%E9%87%87%E6%A0%B7%E7%AE%97%E6%B3%95%EF%BC%9Agreedy%E3%80%81beam-search%E3%80%81top-k%E3%80%81top-p%E3%80%81temperature/","path":"2025/01/26/LLMä¸­çš„æœç´¢ã€é‡‡æ ·ç®—æ³•ï¼šgreedyã€beam-searchã€top-kã€top-pã€temperature/","title":"LLMä¸­çš„æœç´¢ã€é‡‡æ ·ç®—æ³•ï¼šgreedyã€beam_searchã€top_kã€top_pã€temperature"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>LLMä¸­çš„æœç´¢ã€é‡‡æ ·ç®—æ³•ï¼šgreedyã€beam_searchã€top_kã€top_pã€temperature | Ronny Lu's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Ronny Lu's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%90%9C%E7%B4%A2%E9%87%87%E6%A0%B7%E7%AE%97%E6%B3%95"><span class="nav-number">1.</span> <span class="nav-text"> 1 æœç´¢&#x2F;é‡‡æ ·ç®—æ³•</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#11-greedy"><span class="nav-number">1.1.</span> <span class="nav-text"> 1.1ã€greedy</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#12-beam-search"><span class="nav-number">1.2.</span> <span class="nav-text"> 1.2ã€beam search</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#13-top_k"><span class="nav-number">1.3.</span> <span class="nav-text"> 1.3ã€top_k</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#14-top_p"><span class="nav-number">1.4.</span> <span class="nav-text"> 1.4ã€top_p</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#15-temperature"><span class="nav-number">1.5.</span> <span class="nav-text"> 1.5ã€ Temperature</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%83%A9%E7%BD%9A%E6%9C%BA%E5%88%B6"><span class="nav-number">2.</span> <span class="nav-text"> 2ã€æƒ©ç½šæœºåˆ¶</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#21-n-grams"><span class="nav-number">2.1.</span> <span class="nav-text"> 2.1 n-grams</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#22-repetition-penalty"><span class="nav-number">2.2.</span> <span class="nav-text"> 2.2 repetition penalty</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-huggingface%E4%B8%AD%E7%9A%84%E7%94%9F%E6%88%90%E7%AD%96%E7%95%A5"><span class="nav-number">3.</span> <span class="nav-text"> 3ã€huggingFaceä¸­çš„ç”Ÿæˆç­–ç•¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="nav-number">4.</span> <span class="nav-text"> å‚è€ƒé“¾æ¥</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ronny Lu"
      src="https://avatars.githubusercontent.com/u/55233584?v=4">
  <p class="site-author-name" itemprop="name">Ronny Lu</p>
  <div class="site-description" itemprop="description">Tech notes on LLM, LLM Infra, C++</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">50</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://luyiyun1021.github.io/2025/01/26/LLM%E4%B8%AD%E7%9A%84%E6%90%9C%E7%B4%A2%E3%80%81%E9%87%87%E6%A0%B7%E7%AE%97%E6%B3%95%EF%BC%9Agreedy%E3%80%81beam-search%E3%80%81top-k%E3%80%81top-p%E3%80%81temperature/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/55233584?v=4">
      <meta itemprop="name" content="Ronny Lu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ronny Lu's blog">
      <meta itemprop="description" content="Tech notes on LLM, LLM Infra, C++">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="LLMä¸­çš„æœç´¢ã€é‡‡æ ·ç®—æ³•ï¼šgreedyã€beam_searchã€top_kã€top_pã€temperature | Ronny Lu's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          LLMä¸­çš„æœç´¢ã€é‡‡æ ·ç®—æ³•ï¼šgreedyã€beam_searchã€top_kã€top_pã€temperature
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-01-26 17:26:13 / ä¿®æ”¹æ—¶é—´ï¼š17:26:48" itemprop="dateCreated datePublished" datetime="2025-01-26T17:26:13+08:00">2025-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%A4%A7%E6%A8%A1%E5%9E%8B/" itemprop="url" rel="index"><span itemprop="name">å¤§æ¨¡å‹</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E6%8E%A8%E7%90%86%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">æ¨ç†æŠ€æœ¯</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>11k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>40 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><blockquote>
<p>éšç€chatGPTï¼ŒchatGLMã€Llamaç­‰LLMæ¨¡å‹çš„ç«çˆ†ï¼Œç”Ÿæˆå¼æ¨¡å‹é€æ¸è¢«å¤§å®¶æ‰€ç†ŸçŸ¥å’Œè®¤å¯ã€‚</p>
<p>LLMçœ‹ä¼¼å¾ˆç¥å¥‡ï¼Œä½†ç©¶å…¶æœ¬è´¨è¿˜æ˜¯ä¸€ä¸ªæ¦‚ç‡ç›¸å…³çš„é—®é¢˜ï¼šç¥ç»ç½‘ç»œæ ¹æ®è¾“å…¥çš„æ–‡æœ¬ï¼Œæ‰§è¡Œå¤šè½®decoderã€‚ æ¯æ¬¡decoderæ—¶å€™ä»é¢„è®­ç»ƒçš„æ¨¡å‹é‡Œé¢ç”Ÿæˆä¸€å †å€™é€‰è¯ï¼ˆåŠå…¶æ¦‚ç‡/åˆ†æ•°ï¼‰ï¼ŒæŒ‰ç…§æŒ‡å®šçš„è§£ç ç®—æ³•æˆ–è€…è¯´åå¤„ç†ç®—æ³•ï¼Œé€‰æ‹©å‡ºå€™é€‰è¯ï¼ŒçŸ¥é“æ»¡è¶³ç»“æŸğŸ”šæ¡ä»¶ä¸ºæ­¢ã€‚</p>
<p>åŒæ ·çš„LLMæ¨¡å‹ï¼Œå¦‚æœé‡‡ç”¨çš„åå¤„ç†ç®—æ³•ã€ç®—æ³•çš„å‚æ•°è®¾ç½®ä¸åŒï¼Œç”Ÿæˆçš„ç»“æœå¾ˆå¯èƒ½ä¹Ÿä¼šä¸åŒã€‚</p>
<p>ç›®å‰LLMæ¨¡å‹ä¸­å¸¸è§çš„åå¤„ç†ç®—æ³•æœ‰ï¼šgreedyã€beam_searchã€toppã€topkç­‰ã€‚</p>
</blockquote>
<span id="more"></span>
<h3 id="1-æœç´¢é‡‡æ ·ç®—æ³•"><a class="markdownIt-Anchor" href="#1-æœç´¢é‡‡æ ·ç®—æ³•"></a> 1 æœç´¢/é‡‡æ ·ç®—æ³•</h3>
<h4 id="11-greedy"><a class="markdownIt-Anchor" href="#11-greedy"></a> 1.1ã€greedy</h4>
<p>Greedy search æ˜¯æŒ‡åœ¨æ¯ä¸€æ¬¡é€‰æ‹©ä¸‹ä¸€ä¸ªè¯æ—¶ï¼Œæ ¹æ®æ­¤æ¬¡decoderç”Ÿæˆçš„æ¦‚ç‡è¡¨logitsï¼ˆshape == [batch_size, vocab_size] )ï¼Œé€‰æ‹©æ¦‚ç‡æœ€é«˜çš„é‚£ä¸€ä¸ªè¯ï¼ˆtokenï¼‰ã€‚<br />
<img src="https://ronny-1333301201.cos.ap-shanghai.myqcloud.com/20250126164404188.png" alt="image.png" /></p>
<p>ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼š</p>
<p>ä»å•è¯â€œTheâ€å¼€å§‹ï¼Œæ¯æ¬¡ç®—æ³•åœ¨é€‰æ‹©ä¸‹ä¸€ä¸ªè¯æ—¶ï¼Œéƒ½æ¦‚ç‡æœ€é«˜çš„é‚£ä¸€ä¸ªè¯ï¼Œè¿›è€Œï¼Œæœ€ç»ˆçš„ç”Ÿæˆè¯åºåˆ—ä¸ºï¼ˆâ€œTheâ€,â€œniceâ€,â€œwomanâ€ï¼‰ã€‚</p>
<p>è¿™å°±æ˜¯ â€œè´ªå¿ƒç­–ç•¥â€ï¼Œæ°¸è¿œé€‰æ‹©åˆ†æ•°æˆ–æ¦‚ç‡æœ€å¤§çš„tokenã€‚Greedy Searchå­˜åœ¨çš„ä¸€ä¸ªæœ€å¤§çš„é—®é¢˜åœ¨äºï¼Œåªè€ƒè™‘äº†å½“å‰çš„é«˜æ¦‚ç‡è¯ï¼Œå¿½ç•¥äº†åœ¨å½“å‰ä½æ¦‚ç‡è¯åé¢çš„é«˜æ¦‚ç‡è¯ã€‚ å¦‚å›¾1æ‰€ç¤ºï¼šè¯â€œhasâ€åœ¨è¯â€œdogâ€åé¢ï¼Œæ¡ä»¶æ¦‚ç‡é«˜è¾¾0.9ï¼Œä½†è¯â€œdogâ€çš„æ¡ä»¶æ¦‚ç‡åªæ’ç¬¬äºŒï¼Œæ‰€ä»¥greedy searché”™è¿‡äº†è¯åºåˆ—â€œTheâ€ã€â€œdogâ€ã€â€œhasâ€ã€‚</p>
<h4 id="12-beam-search"><a class="markdownIt-Anchor" href="#12-beam-search"></a> 1.2ã€beam search</h4>
<p>ä¸ºäº†é¿å…é”™è¿‡éšè—çš„é«˜æ¦‚ç‡è¯ï¼ŒBeam Searché€šè¿‡å‚æ•°num_beamsçš„é…ç½®ï¼Œå¯ä»¥åœ¨æ¯ä¸ªæ—¶åˆ»ï¼Œè®°å½•æ¦‚ç‡æœ€é«˜çš„_<strong>å‰num_beams</strong>_ï¼ˆbeam_sizeï¼‰ä¸ªè·¯å¾„ï¼Œåœ¨ä¸‹ä¸€ä¸ªæ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªåŸºç¡€è·¯å¾„åŒæ—¶æœç´¢ã€‚</p>
<p>ä»¥num_beams=2ä¸ºä¾‹ï¼Œè¿‡ç¨‹å›¾ï¼š</p>
<p><img src="https://ronny-1333301201.cos.ap-shanghai.myqcloud.com/20250126164417747.png" alt="image.png" /></p>
<p>å¯ä»¥çœ‹åˆ°ï¼š</p>
<p>åœ¨step=1æ—¶ï¼Œæ¦‚ç‡æ˜¯å‰num_beamsçš„è·¯å¾„æ˜¯ï¼ˆâ€œTheâ€ã€â€œniceâ€ï¼‰ã€ï¼ˆâ€œTheâ€ã€â€œdogâ€ï¼‰ã€‚</p>
<p>åœ¨step=2æ—¶ï¼Œæ¦‚ç‡æ˜¯å‰num_beamsçš„è·¯å¾„æ˜¯ï¼ˆâ€œTheâ€ã€â€œdogâ€ã€â€œhasâ€ï¼‰ï¼Œ<em>p = 0.36</em>ï¼›è·¯å¾„ï¼ˆâ€œTheâ€ã€â€œniceâ€ã€â€œwomenâ€ï¼‰ï¼Œ <em>p = 0.2 ã€‚</em></p>
<p>å› æ­¤ï¼Œä¸¤æ¡è·¯å¾„ä¸­ï¼Œæ‰¾åˆ°äº†æ¦‚ç‡æœ€é«˜çš„è·¯å¾„ï¼Œå¾—åˆ°äº†æ›´ä¸ºåˆç†çš„ç­”æ¡ˆã€‚</p>
<p>beam searchç”Ÿæˆçš„è¯åºåˆ—æ¯” greedy searchç”Ÿæˆçš„è¯åºåˆ—çš„ç»¼åˆæ¦‚ç‡æ›´é«˜ï¼Œä½†æ˜¯ä¹Ÿä¸èƒ½ä¿è¯æ˜¯æ•´ä½“æ¦‚ç‡æœ€é«˜çš„è¯åºåˆ—ï¼šå› ä¸ºbeam_searchå¹¶æ²¡æœ‰éå†æ‰€æœ‰å¯èƒ½çš„è¯åºåˆ—çš„ç»„åˆã€‚</p>
<ul>
<li>
<p>å½“num_beams = 1æ—¶ï¼Œ beam_searchç­‰åŒäº greedy search;</p>
</li>
<li>
<p>å½“num_beams = vocab_sizeæ—¶ï¼Œ beam_searchä¼šéå†æ‰€æœ‰å¯èƒ½çš„è¯åºåˆ—ç»„åˆï¼Œä½†è®¡ç®—é‡ä¼šå‘ˆæŒ‡æ•°çº§ä¸Šå‡ã€‚</p>
</li>
</ul>
<p>beam searchåœ¨åšåƒæ˜¯è¯­éŸ³è¯†åˆ«ã€ç¿»è¯‘å’Œæ‘˜è¦è¿™ç±»å¯ä»¥å¤§è‡´é¢„æµ‹ç”Ÿæˆé•¿åº¦çš„åœºæ™¯ä¸­è¡¨ç°è¿˜å¯ä»¥ï¼›</p>
<p>ä½†æ˜¯åœ¨åƒæ˜¯å¯¹è¯å’Œæ•…äº‹ç”Ÿæˆè¿™ç±»å¼€æ”¾ç”Ÿæˆé¢†åŸŸæ•ˆæœå°±å·®å¾—å¤šäº†ã€‚</p>
<p>å…¶æ¬¡ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°beam searchæ¯”è¾ƒå®¹æ˜“ç”Ÿæˆé‡å¤å†…å®¹ï¼› æœ€åï¼Œé«˜æ°´å¹³çš„äººç±»è¯­è¨€ä¸ä¼šæŒ‰ç…§ä¸‹ä¸€ä¸ªè¯æ¡ä»¶æ¦‚ç‡æœ€é«˜çš„æ–¹å¼æ’åˆ—ï¼Œåœ¨åº”ç”¨äºç”Ÿæˆå¼æ¨¡å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬åŒæ ·å¸Œæœ›ç”Ÿæˆçš„å†…å®¹å…·æœ‰å¤šæ ·æ€§ã€‚ æ‰€ä»¥å°±éœ€è¦åœ¨æ­¤åŸºç¡€ä¸Šä¼˜åŒ–é‡‡æ ·æ–¹å¼ã€‚</p>
<hr />
<h4 id="13-top_k"><a class="markdownIt-Anchor" href="#13-top_k"></a> 1.3ã€top_k</h4>
<p>Top-ké‡‡æ ·æ˜¯å¯¹å‰é¢â€œè´ªå¿ƒç­–ç•¥â€çš„ä¼˜åŒ–ï¼Œå®ƒä»æ¦‚ç‡æ’åå‰Kçš„tokenä¹‹ä¸­è¿›è¡ŒæŠ½æ ·ï¼Œä½¿å¾—é™¤äº†åˆ†æ•°æœ€é«˜çš„tokenä¹‹å¤–ï¼Œå…¶ä»–åˆ†æ•°æˆ–æ¦‚ç‡è¾ƒé«˜çš„tokenä¹Ÿæœ‰æœºä¼šè¢«é€‰ä¸­ï¼Œä»¥è¾¾åˆ°æœ‰ä¸€å®šæœºç‡ä¸é€‰æœ€å¤§æ¦‚ç‡çš„è¯ï¼Œå…¶æ ¸å¿ƒæ€æƒ³åœ¨äºï¼šä»å‰Kä¸ªæ¦‚ç‡æœ€å¤§çš„è¯ä¸­æŒ‰å®ƒä»¬çš„æ¦‚ç‡è¿›è¡Œé‡‡æ ·ã€‚</p>
<p>å¦‚ä¸‹å›¾ç¤ºä¾‹ä¸­ï¼Œå‡å¦‚K=3ï¼Œ æˆ‘ä»¬é¦–å…ˆç­›é€‰æ¦‚ç‡å€¼å‰3çš„tokenï¼Œç„¶åä½¿ç”¨ <em><strong>softmax</strong></em> æˆ–è€…æœ€å¤§ä¼¼ç„¶ä¼°è®¡ç­‰æ–¹æ³•é‡æ–°è®¡ç®—é‡‡æ ·æ¦‚ç‡ï¼Œé€šè¿‡è°ƒæ•´kçš„å¤§å°ï¼Œå³å¯æ§åˆ¶é‡‡æ ·åˆ—è¡¨çš„å¤§å°ã€‚ <em>å½“K=1æ—¶ï¼Œ topKç­‰åŒäºgreedy searchã€‚</em></p>
<p><img src="https://ronny-1333301201.cos.ap-shanghai.myqcloud.com/20250126165035897.png" alt="image.png" /></p>
<p>ğŸ¤— HuggingFaceä¸­çš„topKé‡‡æ ·ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">r&#x27;&#x27;&#x27; ğŸ”—ï¼š https://github.com/huggingface/transformers/blob/d7bd325b5a44054341acc536339adab9ef8e8bb2/src/transformers/generation/logits_process.py#L415C38-L415C38 &#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TopKLogitsWarper</span>(<span class="title class_ inherited__">LogitsWarper</span>):</span><br><span class="line">    <span class="string">r&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    [`LogitsWarper`] that performs top-k, i.e. restricting to the k highest probability elements.</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        top_k (`int`):</span></span><br><span class="line"><span class="string">            The number of highest probability vocabulary tokens to keep for top-k-filtering.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, top_k: <span class="built_in">int</span>, filter_value: <span class="built_in">float</span> = -<span class="built_in">float</span>(<span class="params"><span class="string">&quot;Inf&quot;</span></span>), min_tokens_to_keep: <span class="built_in">int</span> = <span class="number">1</span></span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(top_k, <span class="built_in">int</span>) <span class="keyword">or</span> top_k &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;`top_k` has to be a strictly positive integer, but is <span class="subst">&#123;top_k&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.top_k = <span class="built_in">max</span>(top_k, min_tokens_to_keep)</span><br><span class="line">        <span class="variable language_">self</span>.filter_value = filter_value</span><br><span class="line"></span><br><span class="line"><span class="meta">    @add_start_docstrings(<span class="params">LOGITS_PROCESSOR_INPUTS_DOCSTRING</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, input_ids: torch.LongTensor, scores: torch.FloatTensor</span>) -&gt; torch.FloatTensor:</span><br><span class="line">        top_k = <span class="built_in">min</span>(<span class="variable language_">self</span>.top_k, scores.size(-<span class="number">1</span>))  <span class="comment"># Safety check</span></span><br><span class="line">        <span class="comment"># Remove all tokens with a probability less than the last token of the top-k</span></span><br><span class="line">        indices_to_remove = scores &lt; torch.topk(scores, top_k)[<span class="number">0</span>][..., -<span class="number">1</span>, <span class="literal">None</span>]</span><br><span class="line">        scores = scores.masked_fill(indices_to_remove, <span class="variable language_">self</span>.filter_value)</span><br><span class="line">        <span class="comment"># scores.softmax(1)</span></span><br><span class="line">        <span class="keyword">return</span> scores</span><br></pre></td></tr></table></figure>
<p><strong>topKç‰¹ç‚¹</strong>ï¼šè®¾ç½®è¶Šå¤§ï¼Œç”Ÿæˆçš„å†…å®¹çš„éšæœºæ€§è¶Šå¤§ï¼›</p>
<p>è®¾ç½®è¶Šå°ï¼Œç”Ÿæˆçš„å†…å®¹è¶Šå›ºå®šï¼› è®¾ç½®ä¸º1æ—¶ï¼Œå’Œ <code>greedy</code> æ•ˆæœä¸€æ ·ã€‚</p>
<p>ä½†Top-ké‡‡æ ·æœ‰ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼ŒTop-K samplingä¸ä¼šæ ¹æ®ä¸‹ä¸€ä¸ªè¯çš„æ¦‚ç‡åˆ†å¸ƒ ï¼ŒåŠ¨æ€è°ƒæ•´å€™é€‰æ± çš„å¤§å°ã€‚</p>
<p>æ¯”å¦‚æŸäº›æƒ…å†µä¸‹ï¼Œæ¨¡å‹çš„ç”Ÿæˆç»“æœä¸­å‡ºç°1ä¸ªæ¦‚ç‡éå¸¸å¤§çš„tokenï¼Œæ¯”å¦‚è¯´æ¦‚ç‡æœ€é«˜çš„ token çš„æ¦‚ç‡æ˜¯ <em>0.95</em>ï¼Œè€Œç›¸æ¯”ä¹‹ä¸‹å‰©ä¸‹çš„ token æ¦‚ç‡éƒ½å¾ˆä½äº†ã€‚</p>
<p>topKç”±äºéœ€è¦é‡‡æ ·Kä¸ªè¯ï¼Œè¿™ç§æƒ…å†µä¸‹å•çº¯ä½¿ç”¨topKä¼šå‡ºç° <strong>é‡‡æ ·åˆ°è¿‡ä½æ¦‚ç‡tokençš„</strong>æƒ…å†µã€‚</p>
<p>å› æ­¤æˆ‘ä»¬éœ€è¦<strong>å¯¹é¡¶éƒ¨ token çš„ç´¯è®¡æ¦‚ç‡è¿›è¡Œé™åˆ¶</strong>ï¼Œè¿™å°±æ˜¯ä¸‹é¢çš„<strong>TopP é‡‡æ ·</strong>ã€‚</p>
<h4 id="14-top_p"><a class="markdownIt-Anchor" href="#14-top_p"></a> 1.4ã€top_p</h4>
<p>ä¸ºäº†é¿å…å•çº¯ä½¿ç”¨topKå¯èƒ½å‡ºç°çš„é‡‡æ ·åˆ°æ¦‚ç‡è¿‡ä½çš„tokenï¼Œæå‡ºäº†toppã€‚ toppçš„ä¸»è¦åšæ³•æ˜¯è®¾ç½®ä¸€ä¸ª_<strong>æ¦‚ç‡ç•Œé™å€¼p</strong>_ï¼Œç„¶åä»æ¦‚ç‡å¤§çš„è¯ä¸­ç”±å¤§åˆ°å°ä¾æ¬¡å–Kä¸ªï¼Œè‹¥è¿˜æœªå–å¤ŸKä¸ªè¯ï¼Œæ‰€æœ‰å–åˆ°çš„è¯çš„æ¦‚ç‡å’Œå°±å¤§äºç­‰äºç•Œé™å€¼pï¼Œåˆ™æå‰åœæ­¢å–è¯ï¼Œè¿™æ ·å–å‡ºçš„Kä¸ªè¯ä¸­å°±ä¸ä¼šå‡ºç°æ¦‚ç‡ç‰¹åˆ«ä½çš„è¯ã€‚</p>
<p><img src="https://ronny-1333301201.cos.ap-shanghai.myqcloud.com/20250126165013919.png" alt="image.png" /></p>
<p>å‡å¦‚å°† top-p På€¼è®¾å®šä¸º 0.75ï¼Œå³é€‰æ‹©å‰ 75% æ¦‚ç‡çš„ tokens ä½œä¸ºå€™é€‰ã€‚å¦‚å›¾4æ‰€ç¤ºï¼šâ€œè€è™â€ å’Œ â€œè‹¹æœâ€ çš„æ¦‚ç‡åŠ èµ·æ¥ä¸º 80% &gt; 75%ï¼Œæ‰€ä»¥å€™é€‰è¯å°±æ˜¯è¿™ä¿©ã€‚</p>
<p>ç„¶åæŠŠè¿™ä¸¤ä¸ªè¯å†è¿›è¡Œä¸€æ¬¡softmaxä¹‹åï¼Œæ¦‚ç‡æ›´æ–°ä¸º 59.8%å’Œ40.2%ï¼Œä¹‹åå†ä½¿ç”¨å¦‚ torch.multinomial ç­‰éšæœºé‡‡æ ·å‡½æ•°ä¾æ®æ›´æ–°åçš„æ¦‚ç‡åœ¨ â€œè€è™â€ å’Œ &quot;è‹¹æœ&quot;è¿›è¡Œé€‰å–ã€‚</p>
<p>ğŸ¤— HuggingFaceä¸­ TopP çš„ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TopPLogitsWarper</span>(<span class="title class_ inherited__">LogitsWarper</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    [`LogitsWarper`] that performs top-p, i.e. restricting to top tokens summing to prob_cut_off &lt;= prob_cut_off.</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        top_p (`float`):</span></span><br><span class="line"><span class="string">            If set to &lt; 1, only the smallest set of most probable tokens with probabilities that add up to `top_p` or</span></span><br><span class="line"><span class="string">            higher are kept for generation.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, top_p: <span class="built_in">float</span>, filter_value: <span class="built_in">float</span> = -<span class="built_in">float</span>(<span class="params"><span class="string">&quot;Inf&quot;</span></span>), min_tokens_to_keep: <span class="built_in">int</span> = <span class="number">1</span></span>):</span><br><span class="line">        top_p = <span class="built_in">float</span>(top_p)</span><br><span class="line">        <span class="keyword">if</span> top_p &lt; <span class="number">0</span> <span class="keyword">or</span> top_p &gt; <span class="number">1.0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;`top_p` has to be a float &gt; 0 and &lt; 1, but is <span class="subst">&#123;top_p&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(min_tokens_to_keep, <span class="built_in">int</span>) <span class="keyword">or</span> (min_tokens_to_keep &lt; <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;`min_tokens_to_keep` has to be a positive integer, but is <span class="subst">&#123;min_tokens_to_keep&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.top_p = top_p</span><br><span class="line">        <span class="variable language_">self</span>.filter_value = filter_value</span><br><span class="line">        <span class="variable language_">self</span>.min_tokens_to_keep = min_tokens_to_keep</span><br><span class="line"></span><br><span class="line"><span class="meta">    @add_start_docstrings(<span class="params">LOGITS_PROCESSOR_INPUTS_DOCSTRING</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, input_ids: torch.LongTensor, scores: torch.FloatTensor</span>) -&gt; torch.FloatTensor:</span><br><span class="line">        sorted_logits, sorted_indices = torch.sort(scores, descending=<span class="literal">False</span>)</span><br><span class="line">        cumulative_probs = sorted_logits.softmax(dim=-<span class="number">1</span>).cumsum(dim=-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Remove tokens with cumulative top_p above the threshold (token with 0 are kept)</span></span><br><span class="line">        sorted_indices_to_remove = cumulative_probs &lt;= (<span class="number">1</span> - <span class="variable language_">self</span>.top_p)</span><br><span class="line">        <span class="comment"># Keep at least min_tokens_to_keep</span></span><br><span class="line">        sorted_indices_to_remove[..., -<span class="variable language_">self</span>.min_tokens_to_keep :] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># scatter sorted tensors to original indexing</span></span><br><span class="line">        indices_to_remove = sorted_indices_to_remove.scatter(<span class="number">1</span>, sorted_indices, sorted_indices_to_remove)</span><br><span class="line">        scores = scores.masked_fill(indices_to_remove, <span class="variable language_">self</span>.filter_value)</span><br><span class="line">        <span class="keyword">return</span> scores</span><br></pre></td></tr></table></figure>
<p>TopPç‰¹ç‚¹ï¼š</p>
<ul>
<li>
<p>é‡‡ç”¨æ¦‚ç‡é˜ˆå€¼ï¼Œç›¸æ¯”äºçº¯topK,å¯ä»¥é¿å…é‡‡æ ·åˆ°æ¦‚ç‡è¿‡ä½çš„tokens</p>
</li>
<li>
<p>På€¼è¶Šå¤§ï¼Œé‡‡æ ·ç»“æœçš„å¤šæ ·æ€§è¶Šé«˜ï¼Œä½†å¯èƒ½ä¼šé‡‡æ ·åˆ°æ¦‚ç‡è¿‡ä½çš„token</p>
</li>
<li>
<p>På€¼è¶Šå°ï¼Œé‡‡æ ·ç»“æœè¶Šå•ä¸€ã€‚</p>
</li>
</ul>
<p>å¾ˆå¤šæ¨¡å‹ä¼šæŠŠtopKå’ŒtopKç»“åˆä½¿ç”¨ã€‚<em><strong>TopK-Top</strong></em> é‡‡æ ·æ³•å°±æ˜¯å°†TopKé‡‡æ ·æ³•å’ŒTopPé‡‡æ ·æ³•ç›¸ç»“åˆã€‚</p>
<h4 id="15-temperature"><a class="markdownIt-Anchor" href="#15-temperature"></a> 1.5ã€ Temperature</h4>
<p>ä¸Šé¢æ‰€è¯´çš„topk, top_péƒ½æ˜¯åœ¨åŠ¨æ€é€‰æ‹©ä¸åŒè¯çš„èŒƒå›´ï¼Œä½†å¹¶æ²¡æœ‰æ›´æ”¹å®é™…è¯å‡ºç°çš„æ¦‚ç‡ã€‚é‚£ä¹ˆï¼Œæ˜¯å¦å¯ä»¥åœ¨å‡ºç°ä¸Šæ¦‚ç‡ä¸Šä¹Ÿè¿›è¡Œè°ƒèŠ‚å‘¢ï¼Ÿä¾‹å¦‚ï¼Œå°†é«˜é¢‘å’Œä½é¢‘ä¹‹é—´çš„_<strong>æ¦‚ç‡æ‹‰å¤§æˆ–è€…å‡å°‘</strong>_ï¼Œä¹Ÿèƒ½å¤Ÿå¯¹å¤šæ ·æ€§æä¾›ä¸€äº›æ€è·¯ã€‚</p>
<p>å› æ­¤ï¼ŒTemperatueæ¸©åº¦é‡‡æ ·æ–¹å¼è¢«æå‡ºï¼š</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="2.074em"><msub><mi>P</mi><mi>i</mi></msub><mo>=</mo><mfrac><msup><mi>e</mi><mrow><mi>i</mi><mi mathvariant="normal">/</mi><mi>T</mi></mrow></msup><mrow><mstyle scriptlevel="0" displaystyle="false"><msubsup><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mi>n</mi></msubsup></mstyle><msup><mi>e</mi><mrow><mi>j</mi><mi mathvariant="normal">/</mi><mi>T</mi></mrow></msup></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">{\huge P_{i} = \frac{e^{i/T} }{ {\textstyle \sum_{j=0}^{n}} {e^{j/T} }} }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.335996739999999em;vertical-align:-2.0961207399999995em;"></span><span class="mord"><span class="mord sizing reset-size6 size10"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30791166827386696em;"><span style="top:-3.29em;margin-left:-0.13889em;margin-right:0.02410800385728062em;"><span class="pstrut" style="height:3.44em;"></span><span class="sizing reset-size10 size8 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size10">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord sizing reset-size6 size10"><span class="mopen nulldelimiter sizing reset-size10 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0799787849566056em;"><span style="top:-3.4830615236258438em;"><span class="pstrut" style="height:4.074em;"></span><span class="sizing reset-size10 size8 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mop sizing reset-size8 size10"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7809384763741563em;"><span style="top:-3.1552744744455157em;margin-left:0em;margin-right:0.02410800385728062em;"><span class="pstrut" style="height:3.44em;"></span><span class="sizing reset-size10 size8 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.9219961427193826em;margin-right:0.02410800385728062em;"><span class="pstrut" style="height:3.44em;"></span><span class="sizing reset-size10 size8 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4197272613307618em;"><span></span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9410833333333334em;"><span style="top:-3.5160833333333334em;margin-right:0.034722222222222224em;"><span class="pstrut" style="height:3.2em;"></span><span class="sizing reset-size8 size7 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mord mtight">/</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-4.304em;"><span class="pstrut" style="height:4.074em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-4.468em;"><span class="pstrut" style="height:4.074em;"></span><span class="sizing reset-size10 size8 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.988em;"><span style="top:-3.563em;margin-right:0.034722222222222224em;"><span class="pstrut" style="height:3.2em;"></span><span class="sizing reset-size8 size7 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mtight">/</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.010665737704918em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size10 size6"></span></span></span></span></span></span></p>
<p>Temperature é‡‡æ ·ä¸­çš„æ¸©åº¦ä¸ç»å°”å…¹æ›¼åˆ†å¸ƒæœ‰å…³ï¼Œç”±ä¸Šé¢çš„å…¬å¼å¯çŸ¥ï¼Œtemperatureé‡‡æ ·æœ¬è´¨ä¸Šå°±æ˜¯åœ¨ _<strong>Softmax å‡½æ•°ä¸Šæ·»åŠ äº†æ¸©åº¦ï¼ˆTï¼‰</strong>_è¿™ä¸ªå‚æ•°ã€‚</p>
<p>é€šè¿‡å°†logitsé™¤ä»¥æ¸©åº¦æ¥å®ç°æ¸©åº¦é‡‡æ ·ï¼Œç„¶åå°†å…¶è¾“å…¥Softmaxå¹¶è·å¾—é‡‡æ ·æ¦‚ç‡ã€‚</p>
<p>è¶Šä½çš„æ¸©åº¦(&lt; 1.0)ä½¿æ¨¡å‹ä¼šå¯¹é«˜æ¦‚ç‡çš„é€‰æ‹©æ›´ä¸ºåå‘ï¼Œè€Œé«˜äº1.0çš„æ¸©åº¦ï¼Œåˆ™ä¼šç¼©å°é«˜æ¦‚ç‡è¯å’Œä½æ¦‚ç‡è¯ä¹‹é—´çš„å·®è·ã€‚<br />
<img src="https://ronny-1333301201.cos.ap-shanghai.myqcloud.com/20250126165204926.png" alt="image.png" /></p>
<p>Temperature é‡‡æ ·æœ€ç»ˆçš„å®è§‚æ•ˆæœæ˜¯ï¼Œ<strong>åœ¨è¾ƒä½çš„æ¸©åº¦ä¸‹ï¼Œæˆ‘ä»¬çš„æ¨¡å‹æ›´å…·ç¡®å®šæ€§ï¼Œè€Œåœ¨è¾ƒé«˜çš„æ¸©åº¦ä¸‹ï¼Œåˆ™ä¸é‚£ä¹ˆç¡®å®š</strong>ã€‚</p>
<p>ç›®å‰åœ¨huggingface transformersä¸­ï¼Œtemperatureã€topKã€TopPçš„å¤„ç†é»˜è®¤æ˜¯ä¸²è”çš„ï¼Œå…ˆè¿›è¡Œtemperatureï¼Œç„¶åtopkï¼Œæœ€åtoppã€‚ å½“ç„¶ï¼Œå¦‚æœç”¨æˆ·è‡ªå·±å®šä¹‰äº†åˆ†æ•°è¿‡æ»¤å™¨ï¼Œç”¨æˆ·çš„è¿‡æ»¤å™¨ä¼˜å…ˆã€‚</p>
<h3 id="2-æƒ©ç½šæœºåˆ¶"><a class="markdownIt-Anchor" href="#2-æƒ©ç½šæœºåˆ¶"></a> 2ã€æƒ©ç½šæœºåˆ¶</h3>
<h4 id="21-n-grams"><a class="markdownIt-Anchor" href="#21-n-grams"></a> 2.1 n-grams</h4>
<p>ç”Ÿæˆæˆæ¨¡å‹åœ¨å®é™…çš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæ€»ä¼šå‡ºç°ä¸€äº›é‡å¤çš„ä¾‹å­ï¼Œè¿™æ˜¯é«˜é¢‘è¯é€‰æ‹©çš„ç»“æœã€‚ä¸ºäº†è§£å†³é‡å¤é—®é¢˜ï¼Œä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯ç”¨n-gramsæƒ©ç½šï¼Œæ¥è‡ªè®ºæ–‡Paulus et al. (2017)å’ŒKlein et al. (2017)ã€‚</p>
<p>å…¶åŸºæœ¬æ€æƒ³åœ¨äºï¼šé€šå¸¸çš„n-gramsæƒ©ç½šé€šè¿‡é…ç½®ä¸‹ä¸€ä¸ªè¯é‡å¤å‡ºç°n-gramçš„æ¦‚ç‡ä¸º0ï¼Œæ¥ä¿è¯æ²¡æœ‰n-gramå‡ºç°ä¸¤æ¬¡ã€‚</p>
<h4 id="22-repetition-penalty"><a class="markdownIt-Anchor" href="#22-repetition-penalty"></a> 2.2 repetition penalty</h4>
<p>è¿˜å¯ä»¥é€šè¿‡<strong>æƒ©ç½šå› å­å°†å‡ºç°è¿‡è¯çš„æ¦‚ç‡å˜å°æˆ–è€…å¼ºåˆ¶ä¸ä½¿ç”¨é‡å¤è¯æ¥è§£å†³ã€‚</strong></p>
<p>å…¶æ ¸å¿ƒæ€æƒ³åœ¨äºï¼š**å¯¹äºä¹‹å‰å‡ºç°è¿‡çš„è¯è¯­ï¼Œåœ¨åç»­é¢„æµ‹çš„è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡å¼•å…¥æƒ©ç½šå› å­é™ä½å…¶å‡ºç°çš„æ¦‚ç‡ã€‚**æƒ©ç½šå› å­penalty == 1.0æ—¶ï¼Œè¡¨ç¤ºæ²¡æœ‰æƒ©ç½šã€‚</p>
<p>æƒ©ç½šå› å­æ¥è‡ªäºåŒæ ·å¹¿ä¸ºæµä¼ çš„ã€ CTRL: A Conditional Transformer Language Model for Controllable Generation ã€‘:ğŸ“°ï¼š<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1909.05858.pdf">https://arxiv.org/pdf/1909.05858.pdf</a> ã€‚</p>
<p>ğŸ¤—HuggingFaceä¸­çš„å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from  transformers/src/transformers/generation/logits_process.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RepetitionPenaltyLogitsProcessor</span>(<span class="title class_ inherited__">LogitsProcessor</span>):</span><br><span class="line">    <span class="string">r&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    [`LogitsProcessor`] that prevents the repetition of previous tokens through an exponential penalty. This technique</span></span><br><span class="line"><span class="string">    shares some similarities with coverage mechanisms and other aimed at reducing repetition. During the text</span></span><br><span class="line"><span class="string">    generation process, the probability distribution for the next token is determined using a formula that incorporates</span></span><br><span class="line"><span class="string">    token scores based on their occurrence in the generated sequence. Tokens with higher scores are more likely to be</span></span><br><span class="line"><span class="string">    selected. The formula can be seen in the original [paper](https://arxiv.org/pdf/1909.05858.pdf). According to the</span></span><br><span class="line"><span class="string">    paper a penalty of around 1.2 yields a good balance between truthful generation and lack of repetition.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, penalty: <span class="built_in">float</span></span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(penalty, <span class="built_in">float</span>) <span class="keyword">or</span> <span class="keyword">not</span> (penalty &gt; <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;`penalty` has to be a strictly positive float, but is <span class="subst">&#123;penalty&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.penalty = penalty</span><br><span class="line"></span><br><span class="line"><span class="meta">    @add_start_docstrings(<span class="params">LOGITS_PROCESSOR_INPUTS_DOCSTRING</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, input_ids: torch.LongTensor, scores: torch.FloatTensor</span>) -&gt; torch.FloatTensor:</span><br><span class="line">        score = torch.gather(scores, <span class="number">1</span>, input_ids)</span><br><span class="line">        <span class="comment"># if score &lt; 0 then repetition penalty has to be multiplied to reduce the previous token probability</span></span><br><span class="line">        score = torch.where(score &lt; <span class="number">0</span>, score * <span class="variable language_">self</span>.penalty, score / <span class="variable language_">self</span>.penalty)</span><br><span class="line"></span><br><span class="line">        scores.scatter_(<span class="number">1</span>, input_ids, score)</span><br><span class="line">        <span class="keyword">return</span> scores</span><br></pre></td></tr></table></figure>
<h3 id="3-huggingfaceä¸­çš„ç”Ÿæˆç­–ç•¥"><a class="markdownIt-Anchor" href="#3-huggingfaceä¸­çš„ç”Ÿæˆç­–ç•¥"></a> 3ã€huggingFaceä¸­çš„ç”Ÿæˆç­–ç•¥</h3>
<p>huggingFaceä¸ºäº†ä¿è¯å¤šæ ·æ€§ç”Ÿæˆï¼Œæœ‰å¾ˆå¤šå…¶ä»–å‚æ•°æ§åˆ¶ç­–ç•¥ï¼ŒåŒ…æ‹¬é•¿åº¦ã€badwordsç­‰ï¼Œä¸‹é¢æ€»ç»“äº†å…¶ä¸­çš„22ä¸ªå‚æ•°åŠå…¶é‡Šä¹‰ã€‚</p>
<p>ğŸ—‚: <a target="_blank" rel="noopener" href="https://github.com/huggingface/transformers/blob/main/src/transformers/generation/logits_process.py">https://github.com/huggingface/transformers/blob/main/src/transformers/generation/logits_process.py</a></p>
<p><strong>1ã€temperature (float, optional, defaults to 1.0)ï¼š ç”¨äºè°ƒèŠ‚ä¸‹ä¸€ä¸ªæ ‡è®°æ¦‚ç‡çš„å€¼ã€‚</strong></p>
<p><strong>2ã€top_k (int, optional, defaults to 50)ï¼š ç”¨äºtop-kè¿‡æ»¤çš„æœ€é«˜æ¦‚ç‡è¯æ±‡æ ‡è®°çš„æ•°é‡ã€‚</strong></p>
<p><strong>3ã€top_p (float, optional, defaults to 1.0) ï¼š å¦‚æœè®¾ç½®ä¸ºfloat &lt; 1ï¼Œåˆ™åªä¿ç•™æ¦‚ç‡åŠ èµ·æ¥è¾¾åˆ°top_pæˆ–æ›´é«˜çš„æœ€å°çš„æœ€æœ‰å¯èƒ½çš„è¯æ±‡é›†åˆè¿›è¡Œç”Ÿæˆã€‚</strong></p>
<p>4ã€typical_p (float, optional, defaults to 1.0)ï¼š å±€éƒ¨å…¸å‹æ€§è¡¡é‡åœ¨å·²ç»ç”Ÿæˆçš„éƒ¨åˆ†æ–‡æœ¬çš„æƒ…å†µä¸‹ï¼Œé¢„æµ‹ä¸‹ä¸€ä¸ªç›®æ ‡æ ‡è®°çš„æ¡ä»¶æ¦‚ç‡ä¸é¢„æµ‹ä¸‹ä¸€ä¸ªéšæœºæ ‡è®°çš„é¢„æœŸæ¡ä»¶æ¦‚ç‡çš„ç›¸ä¼¼ç¨‹åº¦ã€‚å¦‚æœè®¾ç½®ä¸ºfloat &lt; 1ï¼Œåˆ™ä¿ç•™æœ€å°çš„ã€æ¦‚ç‡ç›¸åŠ ä¸ºtypical_pæˆ–æ›´é«˜çš„å±€éƒ¨å…¸å‹æ ‡è®°çš„é›†åˆï¼Œç”¨äºç”Ÿæˆã€‚</p>
<p>5ã€epsilon_cutoff (float, optional, defaults to 0.0)ï¼šå¦‚æœè®¾ç½®ä¸ºä¸¥æ ¼ä»‹äº0å’Œ1ä¹‹é—´çš„floatï¼Œåªæœ‰æ¡ä»¶æ¦‚ç‡å¤§äºepsilon_cutoffçš„æ ‡è®°ä¼šè¢«é‡‡æ ·ã€‚åœ¨è®ºæ–‡ä¸­ï¼Œå»ºè®®çš„å€¼åœ¨3e-4åˆ°9e-4ä¹‹é—´ï¼Œå–å†³äºæ¨¡å‹çš„å¤§å°ã€‚</p>
<p>6ã€eta_cutoff (float, optional, defaults to 0.0)ï¼š Etaé‡‡æ ·æ˜¯å±€éƒ¨å…¸å‹é‡‡æ ·å’ŒÎµé‡‡æ ·çš„æ··åˆä½“ã€‚å¦‚æœè®¾ç½®ä¸ºä¸¥æ ¼ä»‹äº0å’Œ1ä¹‹é—´çš„æµ®ç‚¹æ•°ï¼Œåªæœ‰å½“ä¸€ä¸ªæ ‡è®°å¤§äºeta_cutoffæˆ–sqrt(eta_cutoff) * exp(-entropy(softmax(next_token_logits)))æ—¶ï¼Œæ‰ä¼šè€ƒè™‘å®ƒã€‚åè€…æ˜¯é¢„æœŸçš„ä¸‹ä¸€ä¸ªä»¤ç‰Œæ¦‚ç‡ï¼Œä»¥ sqrtï¼ˆeta_cutoffï¼‰ä¸ºå°ºåº¦ã€‚åœ¨è®ºæ–‡ä¸­ï¼Œå»ºè®®å€¼ä»3e-4åˆ°2e-3ä¸ç­‰ï¼Œå–å†³äºæ¨¡å‹çš„å¤§å°ã€‚æ›´å¤šç»†èŠ‚è§æˆªæ–­æŠ½æ ·ä½œä¸ºè¯­è¨€æ¨¡å‹å»å¹³æ»‘ã€‚</p>
<p><strong>7ã€diversity_penalty (float, optional, defaults to 0.0)ï¼š å¦‚æœä¸€ä¸ªbeamè·¯å¾„å¾—åˆ†åœ¨æŸä¸€ç‰¹å®šæ—¶é—´äº§ç”Ÿäº†ä¸å…¶ä»–ç»„çš„ä»»ä½•beamè·¯å¾„ç›¸åŒçš„æ ‡è®°ï¼Œè¿™ä¸ªå€¼å°†ä»beamçš„åˆ†æ•°ä¸­å‡å»ã€‚è¯·æ³¨æ„ï¼Œå¤šæ ·æ€§æƒ©ç½šåªæœ‰åœ¨åˆ†ç»„beamæœç´¢è¢«å¯ç”¨æ—¶æ‰æœ‰æ•ˆã€‚</strong></p>
<p><strong>8ã€repetition_penalty (float, optional, defaults to 1.0) ï¼šé‡å¤æ€§æƒ©ç½šçš„å‚æ•°ã€‚1.0æ„å‘³ç€æ²¡æœ‰æƒ©ç½šã€‚</strong></p>
<p>9ã€encoder_repetition_penalty (float, optional, defaults to 1.0)ï¼šå¯¹ä¸åœ¨åŸå§‹è¾“å…¥ä¸­çš„åºåˆ—è¿›è¡ŒæŒ‡æ•°å¼æƒ©ç½šã€‚1.0æ„å‘³ç€æ²¡æœ‰æƒ©ç½šã€‚</p>
<p><strong>10ã€length_penalty (float, optional, defaults to 1.0)ï¼šå¯¹é•¿åº¦çš„æŒ‡æ•°æƒ©ç½šï¼Œç”¨äºbeam searchã€‚å®ƒä½œä¸ºæŒ‡æ•°è¢«åº”ç”¨äºåºåˆ—çš„é•¿åº¦ï¼Œåè¿‡æ¥åˆè¢«ç”¨æ¥åˆ’åˆ†åºåˆ—çš„åˆ†æ•°ã€‚ç”±äºåˆ†æ•°æ˜¯åºåˆ—çš„å¯¹æ•°å¯èƒ½æ€§ï¼ˆå³è´Ÿæ•°ï¼‰ï¼Œlength_penalty &gt; 0.0ä¼šä¿ƒè¿›æ›´é•¿çš„åºåˆ—ï¼Œè€Œlength_penalty &lt; 0.0ä¼šé¼“åŠ±æ›´çŸ­çš„åºåˆ—ã€‚</strong></p>
<p><strong>11ã€no_repeat_ngram_size (int, optional, defaults to 0)ï¼šå¦‚æœè®¾ç½®ä¸ºint &gt; 0ï¼Œæ‰€æœ‰è¯¥å¤§å°çš„ngramsåªèƒ½å‡ºç°ä¸€æ¬¡ã€‚</strong></p>
<p><strong>12ã€bad_words_ids(List[List[int]], optional)ï¼š ä¸å…è®¸ç”Ÿæˆçš„token idçš„åˆ—è¡¨ã€‚ä¸ºäº†è·å¾—ä¸åº”è¯¥å‡ºç°åœ¨ç”Ÿæˆçš„æ–‡æœ¬ä¸­çš„è¯çš„æ ‡è®°IDï¼Œä½¿ç”¨tokenizer(bad_words, add_prefix_space=True, add_special_tokens=False).input_idsï¼Œè¿™ä¸ªèƒ½ç”¨äºæ•æ„Ÿè¯è¿‡æ»¤ã€‚</strong></p>
<p>13ã€force_words_ids(List[List[int]] or List[List[List[int]]], optional)ï¼šå¿…é¡»ç”Ÿæˆçš„æ ‡è®°IDçš„åˆ—è¡¨ã€‚å¦‚æœç»™å®šçš„æ˜¯List[List[int]]ï¼Œè¿™å°†è¢«è§†ä¸ºä¸€ä¸ªå¿…é¡»åŒ…å«çš„ç®€å•å•è¯åˆ—è¡¨ï¼Œä¸bad_words_idsç›¸åã€‚å¦‚æœç»™å®šçš„æ˜¯List[List[List[int]]]ï¼Œè¿™å°†è§¦å‘ä¸€ä¸ªdisjunctiveçº¦æŸï¼Œå³å¯ä»¥å…è®¸æ¯ä¸ªè¯çš„ä¸åŒå½¢å¼ã€‚</p>
<p>14ã€renormalize_logits (bool, optional, defaults to False) ï¼šåœ¨åº”ç”¨æ‰€æœ‰çš„logitså¤„ç†å™¨æˆ–warpersï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰çš„ï¼‰ä¹‹åï¼Œæ˜¯å¦è¦é‡æ–°è§„èŒƒåŒ–logitsã€‚å¼ºçƒˆå»ºè®®å°†æ­¤æ ‡å¿—è®¾ç½®ä¸º â€œTrueâ€ï¼Œå› ä¸ºæœç´¢ç®—æ³•å‡å®šåˆ†æ•°å¯¹æ•°æ˜¯æ­£å¸¸åŒ–çš„ï¼Œä½†ä¸€äº›å¯¹æ•°å¤„ç†å™¨æˆ–ç¿˜æ›²å™¨ä¼šç ´åæ­£å¸¸åŒ–ã€‚</p>
<p>15ã€constraints (List[Constraint], optional)ï¼š å¯ä»¥æ·»åŠ åˆ°ç”Ÿæˆä¸­çš„è‡ªå®šä¹‰çº¦æŸï¼Œä»¥ç¡®ä¿è¾“å‡ºå°†åŒ…å«ä½¿ç”¨Constraintå¯¹è±¡æ‰€å®šä¹‰çš„æŸäº›ä»¤ç‰Œï¼Œå¹¶å°½å¯èƒ½ä»¥æœ€åˆç†çš„æ–¹å¼è¿›è¡Œã€‚</p>
<p><strong>16ã€forced_bos_token_id (int, optional, defaults to model.config.forced_bos_token_id)ï¼šå¼ºåˆ¶ä½œä¸ºè§£ç å™¨_start_token_idä¹‹åç¬¬ä¸€ä¸ªç”Ÿæˆçš„ä»¤ç‰Œçš„idã€‚å¯¹äºåƒmBARTè¿™æ ·çš„å¤šè¯­è¨€æ¨¡å‹éå¸¸æœ‰ç”¨ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¬¬ä¸€ä¸ªç”Ÿæˆçš„æ ‡è®°éœ€è¦æ˜¯ç›®æ ‡è¯­è¨€çš„æ ‡è®°ã€‚</strong></p>
<p>17ã€forced_eos_token_id (Union[int, List[int]], optional, defaults to model.config.forced_eos_token_id) ï¼šå½“è¾¾åˆ°max_lengthæ—¶ï¼Œå¼ºåˆ¶ä½œä¸ºæœ€åç”Ÿæˆçš„ä»¤ç‰Œçš„idã€‚å¯ä»¥é€‰æ‹©ä½¿ç”¨ä¸€ä¸ªåˆ—è¡¨æ¥è®¾ç½®å¤šä¸ªåºåˆ—ç»“æŸçš„æ ‡è®°ã€‚</p>
<p><strong>18ã€remove_invalid_values (bool, optional, defaults to model.config.remove_invalid_values) - æ˜¯å¦åˆ é™¤æ¨¡å‹çš„å¯èƒ½nanå’Œinfè¾“å‡ºï¼Œä»¥é˜²æ­¢ç”Ÿæˆæ–¹æ³•å´©æºƒã€‚æ³¨æ„ï¼Œä½¿ç”¨remove_invalid_valuesä¼šå‡æ…¢ç”Ÿæˆé€Ÿåº¦ã€‚</strong></p>
<p>19ã€exponential_decay_length_penalty (tuple(int, float), optional)ï¼š è¿™ä¸ªTupleåœ¨ç”Ÿæˆä¸€å®šæ•°é‡çš„æ ‡è®°åï¼Œå¢åŠ ä¸€ä¸ªæŒ‡æ•°çº§å¢é•¿çš„é•¿åº¦æƒ©ç½šã€‚è¯¥å…ƒç»„åº”åŒ…æ‹¬ï¼š (start_index, decay_factorï¼‰ï¼Œå…¶ä¸­start_indexè¡¨ç¤ºæƒ©ç½šå¼€å§‹çš„ä½ç½®ï¼Œdecay_factorè¡¨ç¤ºæŒ‡æ•°è¡°å‡çš„ç³»æ•°ã€‚</p>
<p>20ã€suppress_tokens (List[int], optional) ï¼šä¸€ä¸ªåœ¨ç”Ÿæˆæ—¶å°†è¢«æŠ‘åˆ¶çš„æ ‡è®°çš„åˆ—è¡¨ã€‚SupressTokensçš„logitå¤„ç†å™¨å°†æŠŠå®ƒä»¬çš„log probsè®¾ç½®ä¸º-infï¼Œè¿™æ ·å®ƒä»¬å°±ä¸ä¼šè¢«é‡‡æ ·äº†ã€‚</p>
<p>21ã€begin_suppress_tokens (List[int], optional)ï¼š ä¸€ä¸ªå°†åœ¨ç”Ÿæˆä¹‹åˆè¢«æŠ‘åˆ¶çš„æ ‡è®°çš„åˆ—è¡¨ã€‚SupressBeginTokensæ—¥å¿—å¤„ç†å™¨å°†æŠŠå®ƒä»¬çš„æ—¥å¿—probsè®¾ç½®ä¸º-infï¼Œè¿™æ ·å®ƒä»¬å°±ä¸ä¼šè¢«é‡‡æ ·äº†ã€‚</p>
<p>22ã€forced_decoder_ids (List[List[int]], optional) ï¼šä¸€å¯¹æ•´æ•°çš„åˆ—è¡¨ï¼Œè¡¨ç¤ºä»ç”Ÿæˆç´¢å¼•åˆ°æ ‡è®°ç´¢å¼•çš„æ˜ å°„ï¼Œåœ¨é‡‡æ ·å‰å°†è¢«å¼ºåˆ¶ã€‚ä¾‹å¦‚ï¼Œ[[1, 123]]æ„å‘³ç€ç¬¬äºŒä¸ªç”Ÿæˆçš„æ ‡è®°å°†æ€»æ˜¯ä¸€ä¸ªç´¢å¼•ä¸º123çš„æ ‡è®°ã€‚</p>
<h3 id="å‚è€ƒé“¾æ¥"><a class="markdownIt-Anchor" href="#å‚è€ƒé“¾æ¥"></a> å‚è€ƒé“¾æ¥</h3>
<ol>
<li><a target="_blank" rel="noopener" href="https://finisky.github.io/nucleussampling/">https://finisky.github.io/nucleussampling/</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/jarodyv/article/details/128994176">https://blog.csdn.net/jarodyv/article/details/128994176</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/430961578?utm_id=0">https://zhuanlan.zhihu.com/p/430961578?utm_id=0_</a></li>
<li><a target="_blank" rel="noopener" href="https://huggingface.co/blog/how-to-generate">https://huggingface.co/blog/how-to-generate</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ctfiot.com/110138.html">https://www.ctfiot.com/110138.html</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/huggingface/transformers/blob/main/src/transformers/generation/logits_process.py#L415C38-L415C38">https://github.com/huggingface/transformers/blob/main/src/transformers/generation/logits_process.py</a></li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8B/" rel="tag"># å¤§æ¨¡å‹</a>
              <a href="/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%8E%A8%E7%90%86/" rel="tag"># å¤§æ¨¡å‹æ¨ç†</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/01/26/llama-cpp/" rel="prev" title="llama.cpp">
                  <i class="fa fa-angle-left"></i> llama.cpp
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/01/26/Mooncake%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0%EF%BC%9A%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0%E4%BB%A5Cache%E4%B8%BA%E4%B8%AD%E5%BF%83%E7%9A%84%E8%B0%83%E5%BA%A6%E6%80%9D%E6%83%B3%EF%BC%8C%E8%B0%B1%E5%86%99LLM%E6%9C%8D%E5%8A%A1%E9%99%8D%E6%9C%AC%E5%A2%9E%E6%95%88%E6%96%B0%E7%AF%87%E7%AB%A0/" rel="next" title="Mooncakeé˜…è¯»ç¬”è®°ï¼šæ·±å…¥å­¦ä¹ ä»¥Cacheä¸ºä¸­å¿ƒçš„è°ƒåº¦æ€æƒ³ï¼Œè°±å†™LLMæœåŠ¡é™æœ¬å¢æ•ˆæ–°ç¯‡ç« ">
                  Mooncakeé˜…è¯»ç¬”è®°ï¼šæ·±å…¥å­¦ä¹ ä»¥Cacheä¸ºä¸­å¿ƒçš„è°ƒåº¦æ€æƒ³ï¼Œè°±å†™LLMæœåŠ¡é™æœ¬å¢æ•ˆæ–°ç¯‡ç«  <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Ronny Lu</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">197k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">11:56</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  <script src="/js/third-party/pace.js"></script>


  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" integrity="sha256-UF1fgpAiu3tPJN/uCqEUHNe7pnr+QR0SQDNfgglgtcM=" crossorigin="anonymous">
  <script class="next-config" data-name="katex" type="application/json">{"copy_tex_js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/copy-tex.min.js","integrity":"sha256-Us54+rSGDSTvIhKKUs4kygE2ipA0RXpWWh0/zLqw3bs="}}</script>
  <script src="/js/third-party/math/katex.js"></script>



</body>
</html>
